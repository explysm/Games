[gd_scene load_steps=6 format=3 uid="uid://cm1qx0t7ylge0"]

[ext_resource type="Script" uid="uid://bqv17j2ap58ru" path="res://Scenes/player_camera.gd" id="2_6t5aa"]
[ext_resource type="AudioStream" uid="uid://0svxn7v1bjx8" path="res://Sounds/Concrete 1.wav" id="2_cvnsp"]

[sub_resource type="GDScript" id="GDScript_cvnsp"]
script/source = "extends CharacterBody3D

## Strings
const SPEED = 2.0
const MOUSE_SENSITIVITY = 0.003
var rotation_x = 0.0
##
@onready var camera = $PlayerCamera
@onready var footstep = $AudioStreamPlayer3D
var up_pressed = false
var down_pressed = false
var left_pressed = false
var right_pressed = false

func _unhandled_input(event):
	if event is InputEventMouseMotion:
		rotate_y(-event.relative.x * MOUSE_SENSITIVITY)
		rotation_x = clamp(rotation_x - event.relative.y * MOUSE_SENSITIVITY, -1.5, 1.5)
		camera.rotation.x = rotation_x

func _physics_process(delta):
	var input_dir = Vector3.ZERO

	# WASD movement
	if Input.is_action_pressed(\"move_forward\"):
		input_dir -= transform.basis.z
	if Input.is_action_pressed(\"move_back\"):
		input_dir += transform.basis.z
	if Input.is_action_pressed(\"move_left\"):
		input_dir -= transform.basis.x
	if Input.is_action_pressed(\"move_right\"):
		input_dir += transform.basis.x
		
	if up_pressed == true:
		input_dir -= transform.basis.z
	if down_pressed == true:
		input_dir += transform.basis.z
	if left_pressed == true:
		input_dir -= transform.basis.x
	if right_pressed == true:
		input_dir += transform.basis.x

	velocity = input_dir.normalized() * SPEED
	move_and_slide()
	
	if velocity.length() > 0:
		if not footstep.playing:
			footstep.play()
		else:
			if footstep.playing:
				footstep.stop


func _on_up_button_down() -> void:
	up_pressed = true
func _on_up_button_up() -> void:
	up_pressed = false
	
func _on_down_button_down() -> void:
	down_pressed = true
func _on_down_button_up() -> void:
	down_pressed = false
	
func _on_left_button_down() -> void:
	left_pressed = true
func _on_left_button_up() -> void:
	left_pressed = false
	
func _on_right_button_down() -> void:
	right_pressed = true
func _on_right_button_up() -> void:
	right_pressed = false
"

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_cvnsp"]

[sub_resource type="CapsuleMesh" id="CapsuleMesh_v0iea"]

[node name="Player" type="CharacterBody3D"]
script = SubResource("GDScript_cvnsp")

[node name="PlayerCollision" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_cvnsp")

[node name="PlayerCamera" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.46489, -0.446099)
script = ExtResource("2_6t5aa")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.0542084)
mesh = SubResource("CapsuleMesh_v0iea")

[node name="AudioStreamPlayer3D" type="AudioStreamPlayer3D" parent="."]
stream = ExtResource("2_cvnsp")
